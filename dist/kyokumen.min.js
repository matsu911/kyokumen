!function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t){if("string"==typeof t){if(2!=t.length)return console.log("Error: data-made must have two integers",t),null;var e=parseInt(t[0]),r=parseInt(t[1]);if(e&&r)return[e,r]}return null}function r(t){var e=n(t),r=a(t,e),l=i(t,e),d=t.getAttribute("data-sfen")||"",c=t.getAttribute("data-sente"),h=t.getAttribute("data-gote"),g=t.getAttribute("data-title"),m=t.getAttribute("data-made");e.style.width=String(r+l[1]+l[3])+"px",e.style.height=String(r+l[0]+l[2])+"px",e.style.padding="0";var f=new b(e,r,l,d,c,h,g,m);return s(e,r,l),o(e,r,l),u(e,r,l),f.draw(),t.kyokumen=f,f}function n(t){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("class","kyokumen-svg");var r=t.getAttribute("id");return r&&e.setAttribute("id",r+"-svg"),t.appendChild(e),e}function a(t,e){var r=t.getAttribute("data-width");if(r)return Number(r);var n=document.defaultView.getComputedStyle(e,null).width,a=parseFloat(n);return a?a:void console.log("Error in width: "+n)}function i(t,e){var r=t.getAttribute("data-padding");if(r)return r.split(",").map(Number);e=e||getKyokumenSvg(t);var n=[0,0,0,0],a=document.defaultView.getComputedStyle(e,null);return n[0]=parseFloat(a.paddingTop),n[1]=parseFloat(a.paddingRight),n[2]=parseFloat(a.paddingBottom),n[3]=parseFloat(a.paddingLeft),n}function s(t,e,r){var n=document.createElementNS("http://www.w3.org/2000/svg","rect");n.setAttribute("class","ban"),n.setAttribute("x",r[3]),n.setAttribute("y",r[0]),n.setAttribute("width",e),n.setAttribute("height",e),t.appendChild(n);for(var a=e/f,i=1;i<f;i++){var s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("class","sen"),s.setAttribute("x1",r[3]),s.setAttribute("x2",r[3]+e),s.setAttribute("y1",r[0]+a*i),s.setAttribute("y2",r[0]+a*i),t.appendChild(s)}for(var i=1;i<f;i++){var o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1",r[3]+a*i),o.setAttribute("x2",r[3]+a*i),o.setAttribute("class","sen"),o.setAttribute("y1",r[0]),o.setAttribute("y2",r[0]+e),t.appendChild(o)}}function o(t,e,r){for(var n=m.offsetNumCol||.26,a=e/f,i=["９","８","７","６","５","４","３","２","１"],s=0;s<f;s++){var o=document.createElementNS("http://www.w3.org/2000/svg","text");o.setAttribute("class","num"),o.setAttribute("x",r[3]+a*(s+.5)),o.setAttribute("y",r[0]-a*n),o.setAttribute("text-anchor","middle");var u=document.createTextNode(i[s]);o.appendChild(u),t.appendChild(o)}}function u(t,e,r){for(var n=m.offsetNumRow||.55,a=e/f,i=0;i<f;i++){var s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttribute("class","num"),s.setAttribute("x",r[3]+e+a*n),s.setAttribute("y",r[0]+a*(i+.5)),s.setAttribute("text-anchor","middle"),s.setAttribute("dominant-baseline","central");var o=document.createTextNode(v[i]);s.appendChild(o),t.appendChild(s)}}function l(t){var e=document.createElement("link");e.href=t,e.type="text/css",e.rel="stylesheet";var r=document.getElementsByTagName("head")[0],n=r.getElementsByTagName("link")[0];n?r.insertBefore(e,n):r.appendChild(e)}function d(){function t(){e(document.body,null)}function e(t,n){if(1===(t.children||[]).nodeType)return n;if("kyokumen"===t.className)!function(){n=t;var e=r(n);e.svg.addEventListener("click",function(){return e.reset()},!1)}();else if("mv"===t.className){var a=h(t,n);a?t.addEventListener("mouseover",function(){return a.draw()},!1):console.log("Error: unable to create mv in tab",a)}else for(var i=0;i<t.children.length;i++)n=e(t.children[i],n);return n}window.addEventListener("load",t,!1);var n="https://junkoda.github.io/kyokumen/"+m.ver+"/kyokumen.css";l(n)}function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t){if("FIGURE"==t.tagName)return t;var e=t.getAttribute("data-board");if(e){var r=document.getElementById(e);return r?r:void console.log("Error: board not found with id= "+e)}}function h(t,e){if(e=c(t)||e){var r=e.kyokumen,n=t.getAttribute("data-sfen");n||(console.log("Error: unable to get sfen in move:"),console.log(t));var a=t.getAttribute("data-sente")||e.getAttribute("data-sente"),i=t.getAttribute("data-gote")||e.getAttribute("data-gote"),s=t.getAttribute("data-title")||e.getAttribute("data-title"),o=t.getAttribute("data-made");return new w(r,n,a,i,s,o)}}var g=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),m={ver:"0",senteMark:"☗",goteMark:"☖",maxDuplicate:3,handOffset:.1,offsetNumCol:.26,offsetNumRow:.55},f=9,p={l:"香",n:"桂",s:"銀",g:"金",k:"玉",r:"飛",b:"角",p:"歩","+l":"成香","+n":"成桂","+s":"成銀","+r":"龍","+b":"馬","+p":"と"},v=["一","二","三","四","五","六","七","八","九","十","十一","十二","十三","十四","十五","十六","十七","十八"];m.createKyokumen=r,m.Kyokumen=function(t,e,r){var n=new b(t,e,r,"");return s(t,e,r),o(t,e,r),u(t,e,r),n.draw(),n};var b=function(){function r(n,a,i,s,o,u,l,d){t(this,r),this.svg=n,this.width=a,this.margin=i,this.sfen=s,this.sente=o,this.gote=u,this.title=l,this.focus=e(d)}return g(r,[{key:"clear",value:function(){this.clearKyokumen("koma"),this.clearKyokumen("nari-goma"),this.clearKyokumen("sente"),this.clearKyokumen("gote"),this.clearKyokumen("title")}},{key:"clearKyokumen",value:function(t){for(var e=this.svg.getElementsByClassName(t);e.length>0;)this.svg.removeChild(e[0]),e=this.svg.getElementsByClassName(t)}},{key:"draw",value:function(t,e,r,n,a){void 0==t&&(t=t||this.sfen,e=e||this.sente,r=r||this.gote,n=n||this.title,a=a||this.focus),this.clear(),this.drawTitle(n),this.drawPieces(t,e,r,a)}},{key:"isGote",value:function(t){return t==t.toLowerCase()}},{key:"senteLabel",value:function(t){var e=this.width/f,r=this.margin[3]+this.width+e+(this.margin[1]-e)/2,n=this.margin[0]+this.width-m.handOffset*e,a=document.createElementNS("http://www.w3.org/2000/svg","text");return a.setAttribute("class","sente"),a.setAttribute("x",r),a.setAttribute("y",n),a.setAttribute("text-anchor","end"),a.setAttribute("dominant-baseline","central"),t=t?" "+t+" ":" 先手 ",a.appendChild(this.komark(m.senteMark)),a.appendChild(document.createTextNode(t)),a}},{key:"goteLabel",value:function(t){var e=this.margin[3]/2,r=this.margin[0],n=document.createElementNS("http://www.w3.org/2000/svg","text");return n.setAttribute("class","gote"),n.setAttribute("x",e),n.setAttribute("y",r),n.setAttribute("text-anchor","end"),n.setAttribute("dominant-baseline","central"),n.setAttribute("transform","rotate(180 "+e+" "+r+")"),t=t?" "+t+" ":" 後手 ",n.appendChild(this.komark(m.goteMark)),n.appendChild(document.createTextNode(t)),n}},{key:"drawSente",value:function(t,e,r){for(var n=t.length,a=this.senteLabel(e),i=0,s=function(t,e){var r=document.createElementNS("http://www.w3.org/2000/svg","tspan");return r.appendChild(document.createTextNode(p[t.toLowerCase()])),r.setAttribute("class","sente-piece-hand"),r.setAttribute("data-i",e),r.setAttribute("data-p",t.toLowerCase()),r};r<n;){var o=t.charAt(r);if("-"===o||" "===o)break;var u=parseInt(t.substring(r,n));if(u){if(o=t.charAt(r+String(u).length),this.isGote(o))break;if(o&&u<m.maxDuplicate)for(var l=1;l<u;l++)a.appendChild(s(o,i));else o&&(a.appendChild(document.createTextNode(v[u-1])),i+=u-1);r+=String(u).length}else if(this.isGote(o))break;a.appendChild(s(o,i)),r++,i++}return this.svg.appendChild(a),r}},{key:"komark",value:function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","tspan");return e.setAttribute("class","komark"),e.appendChild(document.createTextNode(t)),e}},{key:"drawGote",value:function(t,e,r){for(var n=t.length,a=this.goteLabel(e),i=0,s=function(t,e){var r=document.createElementNS("http://www.w3.org/2000/svg","tspan");return r.appendChild(document.createTextNode(p[t.toLowerCase()])),r.setAttribute("class","gote-piece-hand"),r.setAttribute("data-i",e),r.setAttribute("data-p",t.toLowerCase()),r};r<n;){var o=t.charAt(r);if(!o||"-"===o||" "===o){r++;break}var u=parseInt(t.substring(r,n));if(u){if(o=t.charAt(r+String(u).length),o&&u<m.maxDuplicate)for(var l=1;l<u;l++)a.appendChild(s(o,i)),i++;else o&&(a.appendChild(document.createTextNode(v[u-1])),i+=u-1);r+=String(u).length}else a.appendChild(s(o,i)),r++,i++}return this.svg.appendChild(a),r}},{key:"drawPieces",value:function(t,e,r,n){var a,i=this.width,s=i/f,o=t.length,u=0,l=0;for(a=0;a<o;a++){var d=t.charAt(a);"+"==d&&(d=t.substring(a,a+2),a++);var c=Number(d);if("/"==d)u=0,l++;else if(c)u+=c;else{if(" "==d)break;var h=n&&n[0]==9-u&&n[1]==1+l;this.drawPiece(s,u,l,d,h),u++}}a=this.skipTeban(t,a),a=this.drawSente(t,e,a),a=this.drawGote(t,r,a)}},{key:"drawPiece",value:function(t,e,r,n,a){var i=p[n.toLowerCase()];if(i){var s=this.margin[3]+t*(e+.5),o=this.margin[0]+t*(r+.5),u=document.createElementNS("http://www.w3.org/2000/svg","text");if("+"==n.charAt(0)?u.setAttribute("class","nari-goma"):u.setAttribute("class","koma"),u.setAttribute("x",s),u.setAttribute("y",o),this.isGote(n)){var l="translate("+s+" "+o+")";2==i.length&&(l+=" scale(1.0 0.5)"),l+="rotate(180)",l+="translate("+-s+" "+-o+")",u.setAttribute("transform",l)}else if(2==i.length){var d="translate("+s+" "+o+")";d+=" scale(1.0 0.5)",d+="translate("+-s+" "+-o+")",u.setAttribute("transform",d)}u.setAttribute("text-anchor","middle"),u.setAttribute("dominant-baseline","central");var c;a?(c=document.createElementNS("http://www.w3.org/2000/svg","tspan"),c.setAttribute("class","made"),c.appendChild(document.createTextNode(i))):c=document.createTextNode(i),u.appendChild(c),this.svg.appendChild(u)}else console.log("Error: unknown piece, "+n)}},{key:"skipTeban",value:function(t,e){e=this.skipSpace(t,e);var r=t.length;if(e<r){var n=t.charAt(e);"b"==n||"w"==n?e++:console.log("Error: teban b or w not found")}return e=this.skipSpace(t,e)}},{key:"skipSpace",value:function(t,e){for(var r=t.length;e<r&&" "===t.charAt(e);)e++;return e}},{key:"drawTitle",value:function(t){if(t){var e=this.width/f,r=this.margin[3]+this.width/2,n=(this.margin[0]-e)/2,a=document.createElementNS("http://www.w3.org/2000/svg","text");a.setAttribute("class","title"),a.setAttribute("x",r),a.setAttribute("y",n),a.setAttribute("text-anchor","middle"),a.setAttribute("dominant-baseline","central"),a.appendChild(document.createTextNode(t)),this.svg.appendChild(a)}}},{key:"reset",value:function(){this.draw()}}]),r}();d();var g=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),w=function(){function r(n,a,i,s,o,u){t(this,r),this.kyokumen=n,this.sfen=a,this.sente=i,this.gote=s,this.title=o,this.focus=e(u)}return g(r,[{key:"draw",value:function(){this.kyokumen.draw(this.sfen,this.sente,this.gote,this.title,this.focus)}}]),r}()}();